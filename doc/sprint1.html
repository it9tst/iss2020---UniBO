<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>LABORATORIO DI SISTEMI SOFTWARE 2020 - Sprint 1</title>
        <!-- Bootstrap -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" crossorigin="anonymous">
        <style type="text/css">
            em{
                font-size: 80%;
                font-weight: bold;
                border-style:solid;
                border-color: #e9ecef;
                color: #28a745;
            }
        </style>
    </head>
    <body>
		<div class="jumbotron jumbotron-fluid text-center" style="padding: 5px">
			<h1 class="display-4">LABORATORIO DI SISTEMI SOFTWARE 2020</h1>
			<p class="lead">Sprint 1</p>
		</div>
		<div class="container">
			<div class="row text-center">
				<div class="col-lg-6 offset-lg-3">
				   <h2><u>Requisiti</u></h2>
                    <hr class="my-4">
                </div>
			</div>
            <div>
            
            <h4>Tea-room COVID-19</h4> 

            The <em>manager</em> of a <em>tearoom</em> intends to regulate the access to the service by means of a ddr robot (<em>waiter</em>).
            <br/><br/>
            The <em>tearoom</em> is a rectangular room that includes:

            <ul>
            <li>an <em>entrancedoor</em> to enter in the room and an <em>exitdoor</em> to exit form it;</li>
            <li>a number <tt>N (N=2)</tt> of <em>teatable</em>;</li>
            <li>a <em>serviceare</em> including a <em>servicedesk</em> at which works a <em>barman</em>;</li>
            <li>a <em>hall</em> equipped with a <em>presencedetector</em>, i.e. a device (e.g. a sonar) that can detect the presence of 
            a person (or some other entity) in it.</li>
            </ul>

            The <em>waiter</em> can freely move along the borders of the tearoom, since there are no obstacles there. 

            <center><img src="assets/tearoom20.png" alt="tearoom20.png" width="65%"/></center>


            <h5>User stories</h5>
            As a <em>client</em>:
            <ul>
            <li>I intend to <em>notify</em> my interest in <em>entering</em> in a <em>safe tearoom</em>, <em>sitting</em> at a free teatable,  <em>ordering</em> 
            some tea,  <em>consuming</em> it  (within a limited amount of time <em>maxstaytime</em>)  <em>paying</em> the service
            with my credit card and finally <em>leaving</em> the room.</li>
            <li>For <em>safe tearoom</em>, I intend a tearoom with clean tea-tables posed at a proper distance; the room is populated by human clients 
            whose body temperature is less than <tt>37.5</tt> degrees. </li>
            <li>I can submit my notification of interest by hitting the <em>smartbell</em> located near the  <em>entrancedoor</em> 
            that will automatically measure my body temperature and send a request message to the <em>waiter</em>, by giving to me an unique <em>clientidentifier</em>.
            </li>
            <li>If my body temperature is ok, but my request cannot be immediately satisfied (since the room is full), I will be <em>informed</em> by the <em>waiter</em> 
            about the maximum waiting time.</li>
            </ul>

            As a <em>manager</em>:
            <ul>
            <li>I intend to be able to see the <em>current state</em> of the <em>tearoom</em> by using  a browser connected to a web-server 
            associated to the application.
            </li>
            </ul>


            <h5>Requirements</h5>

            The <em>waiter</em> should perform the following tasks:
            <ul>

            <li><em>accept</em> the request of a client to enter in the tearoom if there is at least one teatable in the state <em>tableclean</em>, i.e.
            the table is free and has been properly cleaned; </li>
            <li><em>inform</em> the client about the maximum waiting time if there is no <em>tableclean</em>;</li> 
            <li><em>reach</em> the <em>entrance door</em> and <em>convoy</em> the accepted client to the selected teatable;</li>
            <li><em>take</em> the order of the client and transmit it (using a wifi-device) to the <em>barman</em>; </li>
            <li><em>serve</em>  the client when the <em>barman</em> says that the requested drink is ready;</li>
            <li><em>collect</em> the payment from the client when he/she has finished to consume or when the <em>maxstaytime</em> is expired;</li>
            <li><em>convoy</em> the client to the <em>exitdoor</em>;</li>
            <li><em>clean</em> the tea-table just freed  by the client;</li>
            <li><em>rest</em> at my <em>home</em> when there is nothing to do.</li>
            </ul>

            Since the room could contain <tt>N</tt> clients at the time, the <em>waiter</em> should reduce as much as possible the waiting time of the requests coming from each client.<br><br>
            
            </div>
			<br>
			<hr>
			<br>
			<div class="row text-center">
				<div class="col-lg-6 offset-lg-3"><u><h2>Analisi dei requisiti</h2></u></div>
                <hr class="my-4">
			</div>
			<div>
				<p>Consideriamo uno scenario semplificato, che non richieda interruzioni e cominciamo a modellarlo.</p>
				<table class="table table-striped table-bordered">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Caso d'uso</th>
                            <th scope="col">Descrizione</th>
                        </tr>
                    </thead>
                    <tbody>
						<tr>
                            <th scope="row">Cliente</th>
                            <td>Virtuale</td>
                        </tr>
                        <tr>
                            <th scope="row">Clienti idonei</th>
                            <td>1</td>
                        </tr>
						<tr>
                            <th scope="row">Clienti non idonei</th>
                            <td>1</td>
                        </tr>
                        <tr>
                            <th scope="row">Tavoli liberi</th>
                            <td>2</td>
                        </tr>
						<tr>
                            <th scope="row">Tavoli sanificati</th>
                            <td>0</td>
                        </tr>
						<tr>
                            <th scope="row">Step 1</th>
                            <td>Il cliente numero 1 arriva alla tearoom con temperatura non idonea, quindi lo smartbell, dopo aver misurato la temperatura, nega l'accesso alla tearoom.</td>
                        </tr>
						<tr>
                            <th scope="row">Step 2</th>
                            <td>Il cliente numero 2 arriva alla tearoom con temperatura idonea, il waiter controlla che ci siano tavoli <br>liberi e sanificati, non essendocene comunica al cliente un tempo di attesa di MAXSTAYTIME. </td>
                        </tr>
						<tr>
                            <th scope="row">Step 3</th>
                            <td>Il waiter va al primo tavolo libero non sanificato, lo sparecchia, lo pulisce e lo apparecchia in sequenza. <br>Successivamente fa accomodare il cliente al tavolo libero e sanificato, prende l'ordinazione, <br>la comunica al barman, che la prepara, e una volta pronta l'ordinazione, la serve al cliente. <br>Al termine fa pagare il cliente e lo accompagna all'uscita.</td>
                        </tr>
                    </tbody>
                </table>
				<p>In questo sprint aggiungiamo una nuova entità: il Barman.</p>
				<table class="table table-striped table-bordered">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Entità</th>
							<th scope="col">Modello</th>
                            <th scope="col">Descrizione</th>
                        </tr>
                    </thead>
                    <tbody>
						<tr>
                            <th scope="row">Waiter</th>
							<td>Attore</td>
                            <td>Risulta essere il cameriere della tearoom. Il suo scopo è quello di accogliere i clienti, prendere gli ordini, comunicarli al barman, servire i clienti, accompagnarli all'uscita e pulire i tavoli sporchi. Interagisce con tutte le altre entità.</td>
                        </tr>
                        <tr>
                            <th scope="row">Smartbell</th>
							<td>Attore</td>
                            <td>Ha lo scopo di segnalare la presenza di un client che vuole entrare nella tearoom. Interagisce con il cliente e il waiter.</td>
                        </tr>
						<tr>
                            <th scope="row">Client</th>
							<td>Attore</td>
                            <td>E' un cliente virtuale che accede alla tearoom. Il suo comportamento tipico prevede di entrare, ordinare, consumare ed uscire dalla tearoom. Interagisce con il waiter e lo smartbell.</td>
                        </tr>
                        <tr>
                            <th scope="row">Barman</th>
							<td>Attore</td>
                            <td>Risulta essere colui che prepara le ordinazioni e avvisa il waiter quando sono pronte. Interagisce solo con il waiter.</td>
                        </tr>
                    </tbody>
                </table>
				<p>Dai requisiti emersi dall'analisi, i messaggi scambiati, tra le entità prese attualmente in esame, sono i seguenti:</p>
				<table class="table table-striped table-bordered">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Messaggio</th>
							<th scope="col">Tipologia</th>
                            <th scope="col">Descrizione</th>
                            <th scope="col">Entità</th>
                            <th scope="col">Parametri</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">enter_request_client</th>
							<td>Request</td>
                            <td>Il client chiede di entrare nella tearoom</td>
                            <td>smartbell - client</td>
                            <td>Temperatura</td>
                        </tr>
                        <tr>
                            <th scope="row">enter_reply_from_smartbell</th>
							<td>Reply</td>
                            <td>E' la risposta positiva di enter_request_client</td>
                            <td>smartbell - client</td>
                            <td>ID Cliente, ID Tavolo</td>
                        </tr>
						<tr>
                            <th scope="row">enter_reply_from_smartbell_n</th>
							<td>Reply</td>
                            <td>E' la risposta negativa di enter_request_client</td>
                            <td>smartbell - client</td>
                            <td>-</td>
                        </tr>
						<tr>
                            <th scope="row">enter_reply_from_smartbell_with_time</th>
							<td>Reply</td>
                            <td>E' la risposta di negativa con tempo di attesa di enter_request_client</td>
                            <td>smartbell - client</td>
                            <td>ID Cliente, MaxStayTime</td>
                        </tr>
						<tr>
                            <th scope="row">go_to_wait_ring</th>
							<td>Dispatch</td>
                            <td>Lo smartbell torna in attesa che un cliente suoni al campanello</td>
                            <td>smartbell</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <th scope="row">smartbell_enter_request</th>
							<td>Request</td>
                            <td>Lo smartbell chiede se il client può entrare nella tearoom</td>
                            <td>smartbell - waiter</td>
                            <td>ID Cliente</td>
                        </tr>
                        <tr>
                            <th scope="row">client_accept</th>
							<td>Reply</td>
                            <td>E' la risposta positiva smartbell_enter_request</td>
                            <td>smartbell - waiter</td>
                            <td>ID Tavolo</td>
                        </tr>
						<tr>
                            <th scope="row">client_accept_with_time</th>
							<td>Reply</td>
                            <td>E' la risposta negativa con tempo di attesa di smartbell_enter_request</td>
                            <td>smartbell - waiter</td>
                            <td>MaxStayTime</td>
                        </tr>
						<tr>
                            <th scope="row">send_order</th>
							<td>Dispatch</td>
                            <td>Il waiter invia al barman l'ordine</td>
                            <td>barman - waiter</td>
                            <td>ID Cliente, Ordine</td>
                        </tr>
						<tr>
                            <th scope="row">barman_complete_order</th>
							<td>Dispatch</td>
                            <td>Il barman ha completato la preparazione dell'ordine</td>
                            <td>barman - waiter</td>
                            <td>ID Cliente, Ordine</td>
                        </tr>
						<tr>
                            <th scope="row">inform_maxwaittime</th>
							<td>Dispatch</td>
                            <td>Il waiter informa il cliente sul tempo di attesa</td>
                            <td>waiter</td>
                            <td>-</td>
                        </tr>
						<tr>
                            <th scope="row">convoy_to_table</th>
							<td>Dispatch</td>
                            <td>Il waiter accompagna il cliente al tavolo</td>
                            <td>waiter</td>
                            <td>ID Tavolo</td>
                        </tr>
                        <tr>
                            <th scope="row">client_ready_to_order</th>
							<td>Dispatch</td>
                            <td>Il client vuole ordinare</td>
                            <td>waiter - client</td>
                            <td>ID Cliente, Ordine</td>
                        </tr>
                        <tr>
                            <th scope="row">client_payment</th>
							<td>Dispatch</td>
                            <td>Il client vuole pagare</td>
                            <td>waiter - client</td>
                            <td>ID Cliente</td>
                        </tr>
						<tr>
                            <th scope="row">start_sanification</th>
							<td>Dispatch</td>
                            <td>Il waiter pulisce il tavolo</td>
                            <td>waiter</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
				<p>Per la gestione dello stato dei singoli tavoli abbiamo utilizzato un array di booleani che descrivono:</p>
				<ul>
					<li>0. Table_isFree (Il tavolo è libero)</li>
					<li>1. Table_isCleared (Il tavolo è sparecchiato)</li>
					<li>2. Table_isCleaned (Il tavolo è pulito)</li>
					<li>3. Table_isSanitized (Il tavolo è sanificato)</li>
				</ul>
				<p>Ecco come si presenta il sistema, da un punto di vista logico, nel suo complesso.</p>
				<center><img src="assets/logico.png" alt="logico.png" width="65%"/></center>
				<br>
				<br>
				<p>Ecco il grafo degli stati che compongono il Waiter.</p>
				<center><img src="assets/statiWaiter.png" alt="statiWaiter.png" width="65%"/></center>
				<br>
				<br>
				<p>Ecco il grafo degli stati che compongono lo Smartbell.</p>
				<center><img src="assets/statiSmartbell.png" alt="statiSmartbell.png" width="50%"/></center>
				<br>
				<br>
				<p>Ecco il grafo degli stati che compongono il Barman.</p>
				<center><img src="assets/statiBarman.png" alt="statiBarman.png" width="50%"/></center>
            </div>
			<br>
			<hr>
			<br>
			<div class="row text-center">
				<div class="col-lg-6 offset-lg-3"><u><h2>Test plan</h2></u></div>
				<hr class="my-4">
			</div>
            <div>
				<p>Si assume che i clienti siano virtuali.</p>
				<p>Il test 1 è visionabile a questo link: <a href="https://github.com/it9tst/iss2020ProjectBO/blob/feature/sprint1_an_req/ct.tearoom/test/test_01.kt">TEST_01</a></p>
				<p><b>1.</b> Il cliente arriva alla tearoom con temperatura maggiore di 37.5 gradi e suona il campanello (stampa del messaggio). Dopo che lo smartbell gli ha misurato la temperatura, viene rifiutato (stampa del messaggio).</p>
				<p>Il test 2 è visionabile a questo link: <a href="https://github.com/it9tst/iss2020ProjectBO/blob/feature/sprint1_an_req/ct.tearoom/test/test_02.kt">TEST_02</a></p>
				<p><b>2.</b> Il cliente arriva alla tearoom con temperatura minore di 37.5 gradi e suona il campanello (stampa del messaggio). Dopo che lo smartbell gli ha misurato la temperatura, viene accettato e comunicato al waiter (stampa del messaggio). Il waiter dopo aver verificato che non vi sono tavoli liberi e puliti (stampa dello stato), comunica al cliente un tempo di attesa MAXSTAYTIME (stampa del messaggio).</p>
            </div>
			<br>
			<hr>
			<br>
			<div class="row text-center">
				<div class="col-lg-6 offset-lg-3"><u><h2>Analisi dei problemi</h2></u></div>
                <hr class="my-4">
			</div>
            <div>
                <p>Dall'analisi dei requisiti si evince che il waiter presenti le seguenti capacità:</p>
				<ul>
					<li>1) capacità di intraprendere le varie azioni di propria iniziativa</li>
					<li>2) reagire agli stimoli esterni</li>
				</ul>
				<p>Visto e considerato che l'esecuzione di una qualsiasi azione del Waiter è una combinazione di azioni appartenenti a 3 categorie: invio di un messaggio, movimento nella tearoom, interazione con oggetti della tearoom e che il Waiter deve essere in grado di eseguire un task e ascoltare nuovi messaggi contemporaneamente, allora siamo spinti a suddividerlo in parti:</p>
				<ul>
					<li>1) WaiterMind: che comunica con le altre entità e gestisce il WaiterEngine (movimento)</li>
					<li>2) WaiterEngine: che gestisca il movimento del robot e la pulizia dei table</li>
				</ul>
				<p>Queste due parti sostituiranno il Waiter dell'analisi dei requisiti, in due nuove attori, dove il primo mantiene la logica di esecuzione del Waiter e il secondo si occuperà di gestire le azioni che interessano la tearoom.</p>
				<p>Per ciò che riguarda l'interazione tra le due parti sfrutteremo dei messaggi appositi modellati come Dispatch in vista delle successive implementazioni che richiederanno l'introduzione di interrupt.</p>
				<p>Per far muovere il Waiter all'interno della tearoom abbiamo bisogno di conoscere la posizione degli oggetti e delle varie entità e per fare ciò utilizzeremo un tool sviluppato direttamente dalla nostra software house: <a href="https://htmlpreview.github.io/?https://raw.githubusercontent.com/anatali/iss2020LabBo/master/it.unibo.planner20/userDocs/LabPlanner.html">it.unibo.planner20</a>.</p>
				<p>Questo comporta l'introduzione di una mappa che dovrà essere gestita da un componente. La mappa viene divisa in celle e chiamiamo con il termine step l'unità dello spostamento del Waiter da una cella ad un'altra adiacente corrispondente alla lunghezza del robot. I veri spostamenti vengono effettuati dal basicrobot: il WaiterMind chiede uno spostamento al WaiterEngine che a sua volta inoltra la richiesta al <a href="https://htmlpreview.github.io/?https://raw.githubusercontent.com/anatali/iss2020LabBo/master/it.unibo.qak20.basicrobot/userDocs/Qak20Basicrobot.html">basicrobot</a>.</p>
				<p>Aggiungiamo i messaggi che servono per consentire lo spostamento:</p>
				<table class="table table-striped table-bordered">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Messaggio</th>
							<th scope="col">Tipologia</th>
                            <th scope="col">Descrizione</th>
                            <th scope="col">Entità</th>
                            <th scope="col">Parametri</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">engineReady</th>
							<td>Dispatch</td>
                            <td>Il WaiterEngine è pronto per ricevere comandi.</td>
                            <td>waiterengine - waitermind</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <th scope="row">moveTo</th>
							<td>Request</td>
                            <td>Il WaiterMind richiede un movimento al WaiterEngine</td>
                            <td>waiterengine - waitermind</td>
                            <td>Coordinate X e Y dell'obiettivo da raggiungere</td>
                        </tr>
						<tr>
                            <th scope="row">done</th>
							<td>Reply</td>
                            <td>E' la risposta positiva di moveTo</td>
                            <td>waiterengine - waitermind</td>
                            <td>Coordinate X e Y dell'obiettivo da raggiungere</td>
                        </tr>
						<tr>
                            <th scope="row">step</th>
							<td>Request</td>
                            <td>Il WaiterEngine comunica con il BasicRobot</td>
                            <td>waiterengine - basicrobot</td>
                            <td>STEPTIME</td>
                        </tr>
						<tr>
                            <th scope="row">stepdone</th>
							<td>Reply</td>
                            <td>E' la risposta positiva di step</td>
                            <td>waiterengine - basicrobot</td>
                            <td>-</td>
                        </tr>
						<tr>
                            <th scope="row">stepfail</th>
							<td>Reply</td>
                            <td>E' la risposta negativa di step</td>
                            <td>waiterengine - basicrobot</td>
                            <td>DURATION, CAUSE</td>
                        </tr>
						<tr>
                            <th scope="row">cmd</th>
							<td>Dispatch</td>
                            <td>Il WaiterEngine comunica con il BasicRobot</td>
                            <td>waiterengine - basicrobot</td>
                            <td>CMD</td>
                        </tr>
                    </tbody>
                </table>
				<p>Per la gestione dello stato dei singoli tavoli, rispetto all'analisi dei problemi, abbiamo aggiunto all'array un valore che indichi l'ID del cliente seduto al tavolo:</p>
				<ul>
					<li>4. ID_client</li>
				</ul>
				<p>Ecco come si presenta il sistema, da un punto di vista logico, nel suo complesso.</p>
				<center><img src="assets/logico2.png" alt="logico.png" width="65%"/></center>
				<br>
				<br>
				<p>Ecco il grafo degli stati che compongono il WaiterMind.</p>
				<center><img src="assets/statiWaiterMind.png" alt="statiWaiterMind.png" width="80%"/></center>
				<br>
				<br>
				<p>Ecco il grafo degli stati che compongono il WaiterEngine.</p>
				<center><img src="assets/statiWaiterEngine.png" alt="statiWaiterEngine.png" width="65%"/></center>
            </div>
			<br>
			<hr>
			<br>
			<div class="row text-center">
				<div class="col-lg-6 offset-lg-3"><u><h2>Test plan</h2></u></div>
				<hr class="my-4">
			</div>
            <div>
				<p>Il test è visionabile a questo link: <a href="https://github.com/it9tst/iss2020ProjectBO/blob/feature/sprint1_an_probl/ct.tearoom/test/test_01.kt">TEST_01</a></p>
				<p>Si verifica il movimento nella tearoom, sfruttando un <a href="https://htmlpreview.github.io/?https://raw.githubusercontent.com/anatali/iss2020LabBo/master/it.unibo.mvirtual2020/userDocs/LabUsingVirtualRobot.html">virtualrobot</a> e verificando le effettive posizioni del Waiter tra i vari step.</p>
				<p>Si assume che il cliente sia virtuale.</p>
				<ul>
					<li>Il cliente arriva alla tearoom con temperatura minore di 37.5 gradi e suona il campanello. Dopo che lo smartbell gli ha misurato la temperatura, viene accettato e comunicato al waiter. Dopo aver controllato che vi è almeno un tavolo pulito e libero, fa accomodare il cliente. Il cliente ordina, il waiter comunica al barman l'ordinazione, il barman la prepara e comunica al waiter quando è pronta, il waiter la prende per servirla al cliente che una volta finito di consumare paga il waiter ed esce dalla tearoom. A questo punto il waiter pulisce in fasi il tavolo sporco attraversando tutti e tre gli stati.</li>
				</ul>
            </div>
			<br>
			<br>
		</div>
        <div class="container-fluid" style="background-color: #e9ecef; padding: 15px 0px">
            <div class="container">
                <div class="card-group" style="margin: 0 auto; width: 600px;">
                    <div class="card">
                        <img src="assets/vc.jpg" class="card-img-top">
                        <div class="card-body">
                            <h5 class="card-title">Vittorio Corsale</h5>
                            <p class="card-text">vittorio.corsale@studio.unibo.it</p>
                        </div>
                    </div>
                    <div class="card">
                        <img src="assets/gt.jpg" class="card-img-top">
                        <div class="card-body">
                            <h5 class="card-title">Gabriele Tornatore</h5>
                            <p class="card-text">gabriele.tornatore@studio.unibo.it</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>